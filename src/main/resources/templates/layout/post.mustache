<div class="boardModal modal" id="boardModal">
    <!-- ì¤‘ì•™ì— ì‘ê²Œ í‘œì‹œë˜ë„ë¡ ìˆ˜ì • -->
    <div class="bmodal-board-modal-content modal-content">
        <div class="modal-header">
            <h5 class="modal-title" id="boardModalLabel">ì´ë²¤íŠ¸ ê³µì§€</h5>
            <button type="button" class="btn-close" id="closeModalBtn" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <!-- ëª¨ë‹¬ ë‚´ìš©ì´ ë™ì ìœ¼ë¡œ ì¶”ê°€ë  ë¶€ë¶„ -->
        </div>
    </div>
</div>

<div class="content-box">
    {{#modal.boards}}
        <div class="group-name">{{socialName}}</div>
        <div class="post">
            <div class="author-box">
                <img src="{{userImage}}" alt="Profile Picture" class="profile-picture openModalBtn"
                     data-board-id="{{boardId}}">
                <div>
                    <button data-board-id="{{boardId}}" class="book-button {{#book}}book{{/book}}">
                        <i class="fas fa-star"></i>
                    </button>
                    <div class="author">{{nickname}}</div>
                    <div class="date">{{createdAt}}</div>
                </div>
            </div>
            <div class="message-box">
                {{#albums}}
                    <div class="media-item">
                        {{#isImage}}
                            <img src="{{path}}" alt="Image"
                                 style="max-width: 100%; max-height: 300px; margin-bottom: 10px;">
                        {{/isImage}}
                        {{#isVideo}}
                            <video controls style="max-width: 100%; max-height: 300px;">
                                <source src="{{path}}" type="video/mp4">
                                Your browser does not support the video tag.
                            </video>
                        {{/isVideo}}
                    </div>
                {{/albums}}
                <div class="message openModalBtn" data-board-id="{{boardId}}">
                    {{{content}}}
                </div>
                {{^hashEmpty}}
                    <div class="media-box">
                        <div class="hashtag-box">
                            {{#hashtagList}}
                                <button class="hashtag-btn">{{name}}</button>
                            {{/hashtagList}}
                        </div>
                    </div>
                {{/hashEmpty}}
                <div class="comments">
                    <div class="like-count">ğŸ˜ŠğŸ˜ì¢‹ì•„ìš” <span class="like-count-value">{{likeCount}}</span></div>
                    <div class="comment-count">ğŸ’¬ëŒ“ê¸€ {{replyCount}}</div>
                </div>
            </div>
        </div>
        <div class="comment-section-container">
            <button class="like-button {{#liked}}liked{{/liked}}" data-board-id="{{boardId}}">
                <i class="fas fa-heart"></i>
            </button>

            <form action="/reply/save" method="post">
                <div class="d-flex">

                    <div class="comment-section">
                        <input type="hidden" name="socialId" value="{{socialId}}">
                        <input type="hidden" name="boardId" value="{{boardId}}">
                        <img src="{{myProfileImage}}" alt="Commenter Picture" class="comment-picture">
                        <input type="text" name="comment" placeholder="ëŒ“ê¸€ì„ ë‚¨ê²¨ì£¼ì„¸ìš”.">
                    </div>
                    <div>
                        <button type="submit" class="send-button">ë³´ë‚´ê¸°</button>
                    </div>

                </div>
            </form>

        </div>
    {{/modal.boards}}

    {{#modals.boards}}
        <div class="group-name">{{socialName}}</div>
        <div class="post">
            <div class="author-box">
                <img src="{{userImage}}" alt="Profile Picture" class="profile-picture openModalBtn"
                     data-board-id="{{boardId}}">
                <div>
                    <button data-board-id="{{boardId}}" class="book-button {{#book}}book{{/book}}">
                        <i class="fas fa-star" style="color: yellow"></i>
                    </button>
                    <div class="author">{{nickname}}</div>
                    <div class="date">{{createdAt}}</div>
                </div>
            </div>
            <div class="message-box">
                {{#albums}}
                    <div class="media-item">
                        {{#isImage}}
                            <img src="{{path}}" alt="Image"
                                 style="max-width: 100%; max-height: 300px; margin-bottom: 10px;">
                        {{/isImage}}
                        {{#isVideo}}
                            <video controls style="max-width: 100%; max-height: 300px;">
                                <source src="{{path}}" type="video/mp4">
                                Your browser does not support the video tag.
                            </video>
                        {{/isVideo}}
                    </div>
                {{/albums}}
                <div class="message openModalBtn" data-board-id="{{boardId}}">
                    {{{content}}}
                </div>
                {{^hashEmpty}}
                    <div class="media-box">
                        <div class="hashtag-box">
                            {{#hashtagList}}
                                <button class="hashtag-btn">{{name}}</button>
                            {{/hashtagList}}
                        </div>
                    </div>
                {{/hashEmpty}}
                <div class="comments">
                    <div class="like-count">ğŸ˜ŠğŸ˜ì¢‹ì•„ìš” <span class="like-count-value">{{likeCount}}</span></div>
                    <div class="comment-count">ğŸ’¬ëŒ“ê¸€ {{replyCount}}</div>
                </div>
            </div>
        </div>
        <div class="comment-section-container">
            <button class="like-button {{#liked}}liked{{/liked}}" data-board-id="{{boardId}}">
                <i class="fas fa-heart"></i>
            </button>
            <div class="comment-section">
                <form action="/reply/save" method="post">
                    <img src="{{myProfileImage}}" alt="Commenter Picture" class="comment-picture">
                    <input type="text" name="comment" placeholder="ëŒ“ê¸€ì„ ë‚¨ê²¨ì£¼ì„¸ìš”.">
                </form>
            </div>
            <button type="submit" class="send-button">ë³´ë‚´ê¸°</button>
        </div>
    {{/modals.boards}}

    {{#myBoardModel.myBoardList}}
        <div class="group-name">{{socialName}}</div>
        <div class="post">
            <div class="author-box">
                <img src="{{userImage}}" alt="Profile Picture" class="profile-picture openModalBtn"
                     data-board-id="{{boardId}}">
                <div>
                    <button data-board-id="{{boardId}}" class="book-button {{#book}}book{{/book}}">
                        <i class="fas fa-star" style="color: yellow"></i>
                    </button>
                    <div class="author">{{nickname}}</div>
                    <div class="date">{{createdAt}}</div>
                </div>
            </div>
            <div class="message-box">
                {{#albums}}
                    <div class="media-item">
                        {{#isImage}}
                            <img src="{{path}}" alt="Image"
                                 style="max-width: 100%; max-height: 300px; margin-bottom: 10px;">
                        {{/isImage}}
                        {{#isVideo}}
                            <video controls style="max-width: 100%; max-height: 300px;">
                                <source src="{{path}}" type="video/mp4">
                                Your browser does not support the video tag.
                            </video>
                        {{/isVideo}}
                    </div>
                {{/albums}}
                <div class="message openModalBtn" data-board-id="{{boardId}}">
                    {{{content}}}
                </div>
                {{^hashEmpty}}
                    <div class="media-box">
                        <div class="hashtag-box">
                            {{#hashtagList}}
                                <button class="hashtag-btn">{{name}}</button>
                            {{/hashtagList}}
                        </div>
                    </div>
                {{/hashEmpty}}
                <div class="comments">
                    <div class="like-count">ğŸ˜ŠğŸ˜ì¢‹ì•„ìš” <span class="like-count-value">{{likeCount}}</span></div>
                    <div class="comment-count">ğŸ’¬ëŒ“ê¸€ {{replyCount}}</div>
                </div>
            </div>
        </div>
        <div class="comment-section-container">
            <button class="like-button {{#liked}}liked{{/liked}}" data-board-id="{{boardId}}">
                <i class="fas fa-heart"></i>
            </button>
            <div class="comment-section">
                <form action="/reply/save" method="post">
                    <img src="{{myProfileImage}}" alt="Commenter Picture" class="comment-picture">
                    <input type="text" name="comment" placeholder="ëŒ“ê¸€ì„ ë‚¨ê²¨ì£¼ì„¸ìš”.">
                </form>
            </div>
            <button type="submit" class="send-button">ë³´ë‚´ê¸°</button>
        </div>
    {{/myBoardModel.myBoardList}}
</div>

<script>
    $(document).ready(function () {
        let modal = $("#boardModal");

        // ì¢‹ì•„ìš” ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
        $('.bmodal-like-icon').on('click', function () {
            var likeCount = $(this).siblings('.bmodal-like-count');
            var count = parseInt(likeCount.text());
            if ($(this).hasClass('far')) {
                $(this).removeClass('far').addClass('fas');
                likeCount.text(count + 1);
            } else {
                $(this).removeClass('fas').addClass('far');
                likeCount.text(count - 1);
            }
        });

        // ëŒ“ê¸€ ì‚­ì œ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
        $(document).on('click', '.delete-comment-button', function () {
            var $comment = $(this).closest('.bmodal-board-comment, .bmodal-reply');
            var commentId = $comment.data('comment-id'); // ëŒ“ê¸€ ID ê°€ì ¸ì˜¤ê¸°

            // ì„œë²„ì— ì‚­ì œ ìš”ì²­
            $.ajax({
                type: 'DELETE',
                url: '/comment/delete?commentId=' + commentId, // URL ë§¤ê°œë³€ìˆ˜ë¡œ commentId ì „ì†¡
                success: function (response) {
                    if (response.success) {
                        // ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ë©´ ëŒ“ê¸€ì„ UIì—ì„œ ì œê±°
                        $comment.remove();
                    } else {
                        console.error('Error:', response.message);
                    }
                },
                error: function (xhr, status, error) {
                    console.error('Error:', error);
                }
            });
        });

        // ì¢‹ì•„ìš” ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
        $(document).on('click', '.like-button', function () {
            var $this = $(this);
            var boardId = $this.data('board-id');
            var isLiked = $this.hasClass('liked');
            var method = isLiked ? 'DELETE' : 'POST';
            var url = isLiked ? '/like/delete' : '/like/save';

            // ì¦‰ì‹œ UI ì—…ë°ì´íŠ¸
            $this.toggleClass('liked');
            $this.find('.fa-heart').css('color', isLiked ? '#aaaaaa' : 'red');

            // ì„œë²„ì— ìƒíƒœ ì—…ë°ì´íŠ¸ ìš”ì²­
            $.ajax({
                type: method,
                url: url + '?boardId=' + boardId, // URL ë§¤ê°œë³€ìˆ˜ë¡œ boardId ì „ì†¡
                success: function (response) {
                    if (!response.success) {
                        // ì„œë²„ ìš”ì²­ì´ ì‹¤íŒ¨í•˜ë©´ UIë¥¼ ë‹¤ì‹œ ì›ë˜ ìƒíƒœë¡œ ëŒë¦¼
                        $this.toggleClass('liked');
                        $this.find('.fa-heart').css('color', isLiked ? 'red' : '#aaaaaa');
                    }
                },
                error: function (xhr, status, error) {
                    console.error('Error:', error);
                    // ì—ëŸ¬ê°€ ë°œìƒí•˜ë©´ UIë¥¼ ë‹¤ì‹œ ì›ë˜ ìƒíƒœë¡œ ëŒë¦¼
                    $this.toggleClass('liked');
                    $this.find('.fa-heart').css('color', isLiked ? 'red' : '#aaaaaa');
                }
            });
        });

        // ë¶ë§ˆí¬ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
        $(document).on('click', '.book-button', function () {
            var $this = $(this);
            var boardId = $this.data('board-id');
            var isBooked = $this.hasClass('book');
            var method = isBooked ? 'DELETE' : 'POST';
            var url = isBooked ? '/bookmark/delete' : '/bookmark/save';

            // ì¦‰ì‹œ UI ì—…ë°ì´íŠ¸
            $this.toggleClass('book');
            $this.find('.fa-star').css('color', isBooked ? '#aaaaaa' : 'yellow');

            // ì„œë²„ì— ìƒíƒœ ì—…ë°ì´íŠ¸ ìš”ì²­
            $.ajax({
                type: method,
                url: url + '?boardId=' + boardId, // URL ë§¤ê°œë³€ìˆ˜ë¡œ boardId ì „ì†¡
                success: function (response) {
                    if (!response.success) {
                        // ì„œë²„ ìš”ì²­ì´ ì‹¤íŒ¨í•˜ë©´ UIë¥¼ ë‹¤ì‹œ ì›ë˜ ìƒíƒœë¡œ ëŒë¦¼
                        $this.toggleClass('book');
                        $this.find('.fa-star').css('color', isBooked ? 'yellow' : '#aaaaaa');
                    } else {
                        // ì„±ê³µì ìœ¼ë¡œ ë¶ë§ˆí¬ ìƒíƒœê°€ ì—…ë°ì´íŠ¸ëœ ê²½ìš°, í˜ì´ì§€ ë¦¬ë¡œë“œ
                        if (isBooked) {
                            location.reload(); // ë¶ë§ˆí¬ ì‚­ì œ ì‹œì—ë§Œ í˜ì´ì§€ ë¦¬ë¡œë“œ
                        }
                    }
                },
                error: function (xhr, status, error) {
                    console.error('Error:', error);
                    // ì—ëŸ¬ê°€ ë°œìƒí•˜ë©´ UIë¥¼ ë‹¤ì‹œ ì›ë˜ ìƒíƒœë¡œ ëŒë¦¼
                    $this.toggleClass('book');
                    $this.find('.fa-star').css('color', isBooked ? 'yellow' : '#aaaaaa');
                }
            });
        });

        // ëª¨ë‹¬ ì¼œëŠ” ê¸°ëŠ¥
        $(document).on('click', '.openModalBtn', function () {
            console.log("ë²„íŠ¼ ëˆŒë¦¼");
            var boardId = $(this).data('board-id');
            $.ajax({
                url: '/board/detail/',
                method: 'GET',
                data: {boardId: boardId}, // RequestParamìœ¼ë¡œ boardId ì „ì†¡
                dataType: 'json',
                success: function (data) {
                    var detail = data;
                    var hashtagList = detail.hashtagList || []; // hashtagListê°€ ì—†ìœ¼ë©´ ë¹ˆ ë°°ì—´ ì‚¬ìš©
                    var replyList = detail.replyList || []; // replyListê°€ ì—†ìœ¼ë©´ ë¹ˆ ë°°ì—´ ì‚¬ìš©

                    var modalBodyHtml = `
               <div class="bmodal-user-info">
                    <img src="${detail.userImage}" alt="User Image" class="rounded-circle bmodal-user-image">
                    <div class="bmodal-user-details">
                        <strong>${detail.nickname}</strong>
                        <p class="bmodal-date">${detail.createdAt}</p>
                    </div>
                </div>
                <p>${detail.content}</p>
                <div class="bmodal-hashtags">
                    ${hashtagList.map(hashtag => `<span class="bmodal-hashtag">${hashtag.name}</span>`).join('')}
                </div>
                <div class="bmodal-board-actions">
                    <div class="bmodal-likes-comments">
                        <i class="far fa-heart bmodal-like-icon"></i>
                        <span>ì¢‹ì•„ìš”</span>
                        <span class="bmodal-like-count">${detail.likeCount}</span>
                    </div>
                    <div class="bmodal-likes-comments">
                        <i class="fas fa-comment bmodal-comment-icon"></i>
                        <span>ëŒ“ê¸€ì“°ê¸°</span>
                        <span class="bmodal-comment-count">${detail.replyCount}</span>
                    </div>
                </div>
                <div class="bmodal-board-comment-section">
    ${replyList.map(reply => `
        <div class="bmodal-board-comment" data-comment-id="${reply.id}">
            <div class="comment-content">
                <img src="${reply.userImage}" alt="Profile Picture" class="comment-profile-image">
                <div>
                    <strong>${reply.nickname}</strong>
                    <p>${reply.content}</p>
                    <div class="comment-meta">
                        <span class="comment-time">${reply.createdAt}</span>
                        <button class="reply-button">ë‹µê¸€ì“°ê¸°</button>
                    </div>
                </div>
                <button class="delete-comment-button" data-comment-id="${reply.id}">
                    <i class="fas fa-trash-alt"></i>
                </button>
            </div>
            <div class="bmodal-reply-section">
                ${reply.rereplyList.map(rereply => `
                    <div class="bmodal-board-comment bmodal-reply" data-comment-id="${rereply.id}">
                        <div class="comment-content">
                            <img src="${rereply.userImage}" alt="Profile Picture" class="reply-profile-image">
                            <div>
                                <strong>${rereply.nickname}</strong>
                                <p>${rereply.content}</p>
                                <div class="comment-meta">
                                    <span class="comment-time">${rereply.createdAt}</span>
                                    <button class="reply-button">ë‹µê¸€ì“°ê¸°</button>
                                </div>
                            </div>
                            <button class="delete-comment-button" data-comment-id="${rereply.id}">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                    </div>
                `).join('')}
            </div>
        </div>
    `).join('')}
</div>
            `;
                    $('#boardModal .modal-body').html(modalBodyHtml);
                    $('#boardModal').css('display', 'block'); // ëª¨ë‹¬ì„ í™”ë©´ì— í‘œì‹œ
                },
                error: function (xhr, status, error) {
                    console.error("AJAX ì˜¤ë¥˜:", error);
                }
            });
        });

        // ëª¨ë‹¬ ë‹«ê¸° ê¸°ëŠ¥
        $('#closeModalBtn').on('click', function () {
            modal.css('display', 'none'); // ëª¨ë‹¬ì„ í™”ë©´ì—ì„œ ìˆ¨ê¹€
        });

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ëª¨ë‹¬ ë‹«ê¸°
        $(window).on('click', function (event) {
            if (event.target === modal[0]) {
                modal.css('display', 'none'); // ëª¨ë‹¬ì„ í™”ë©´ì—ì„œ ìˆ¨ê¹€
            }
        });
    });


</script>